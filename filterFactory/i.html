<!DOCTYPE html>
<HTML>
<HEAD>
<META charset="UTF-8">

<SCRIPT type="text/javascript">
var pendingPhotos = [];  // array of blobs or files
var filters = [
   {
      name: "f1",
      value: "feColorMatrix type=\"matrix\" values=\"0.6666 0.6666 0.6666 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0\""
   },{
      name: "f2",
//    value: "feColorMatrix type=\"matrix\" values=\"0.4214 -0.0285 0.0652 0 0 0.0158 0.4596 -0.0172 0 0 -0.0575 0.0833 0.5279 0 0 0 0 0 1 0\""
      value: "feColorMatrix type=\"matrix\" values=\"-0.0257 1.2426 -0.0402 0.0000 0.0000 0.3113 0.0074 0.1600 0.0000 0.0000 0.8248 0.1325 -1.1995 0.0000 0.0000 0.0000 0.0000 0.0000 1.0000 0.0000\""
   },{
      name: "f3",
      value: "feColorMatrix type=\"matrix\" values=\"0.0000 0.0786 0.4759 0.0000 0.0000 0.2832 0.0000 -0.1354 0.0000 0.0000 -0.8039 0.0000 -0.0792 0.0000 0.0000 0.0000 0.0000 0.0000 1.0000 0.0000\""
   }
];

function doFilter2(img) {
   var fId = "fIgrm";
   var fId2 = "fIgr2";
   var fId3 = "fIgr3";
   var fId4 = "fIgr4";
   var foo = (
     "<svg width='281' height='281' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'>" +
       "<g transform='translate(-84, 0)'>" +
         "<g>" +
            "<image xlink:href='" + img.src +
            "' width='450' height='281' filter='url(data:image/svg+xml," +
            escape(
               "<svg xmlns='http://www.w3.org/2000/svg'><filter id='" + fId + "'>" +
               "<feComponentTransfer>" +
                  "<feFuncR type='table' tableValues='0.0000 0.0627 0.1255 0.2118 0.2824 0.3412 0.4510 0.5451 0.6314 0.7059 0.7686 0.8118 0.8549 0.9059 0.9412 0.9686 1.0000'/>" +
                  "<feFuncG type='table' tableValues='0.0000 0.0471 0.0941 0.1451 0.2039 0.2745 0.3412 0.4196 0.4980 0.5686 0.6392 0.7216 0.7686 0.8157 0.8549 0.8824 0.8941'/>" +
                  "<feFuncB type='table' tableValues='0.0706 0.1608 0.2471 0.3216 0.3608 0.4471 0.5020 0.5529 0.5804 0.6118 0.6275 0.6588 0.6824 0.7255 0.7843 0.8706 1.0000'/>" +
               "</feComponentTransfer>" +
               "</filter></svg>"
            ) +
            "#" + fId + ")'></image>" +
         "</g>" +
         "<g>" +
            "<image xlink:href='" + img.src +
            "' width='450' height='281'" +
            " filter='url(data:image/svg+xml," +
            escape(
               "<svg xmlns='http://www.w3.org/2000/svg'><filter id='" + fId2 + "'>" +
               "<feGaussianBlur stdDeviation='2'/>" +
               "<feColorMatrix type='matrix' values='0.61 0 0 0 0 0 0.61 0 0 0 0 0 0.61 0 0 0 0 0 1 0'/>" +
               "</filter></svg>"
            ) +
            "#" + fId2 + ")'" +
            " mask ='url(data:image/svg+xml," +
            escape(
               "<svg xmlns='http://www.w3.org/2000/svg'>" +
               "<mask id='" + fId3 +
               "' maskUnits='objectBoundingBox' maskContentUnits='objectBoundingBox'>" +
               "<rect x='0' y='0' width='1' height='1' stroke-width='0'" +
               " fill='url(data:image/svg+xml," +
               escape(
                  "<svg xmlns='http://www.w3.org/2000/svg'><radialGradient id='" + fId3 + "'" +
                     " gradientUnits='objectBoundingBox' cx='0.5' cy='0.31' r='0.65'" +
                     " gradientTransform='scale(1.0, 1.6)'" +
                  ">" +
                     "<stop offset='0.4' stop-color='#ffffff' stop-opacity='0'/>" +
                     "<stop offset='0.6' stop-color='#ffffff' stop-opacity='1'/>" +
                  "</radialGradient></svg>"
               ) +
               "#" + fId3 + ")'" +
               "/>" +
               "</mask></svg>"
            ) +
            "#" + fId3 + ")'" +
            "></image>" +
         "</g>" +
         "<g fill='none' stroke='white' stroke-width='10' >" +
           "<rect x='89' y='5' width='271' height='271'/>" +
         "</g>" +
       "</g>" +
     "</svg>"
   );
   return new Blob([foo], {type:"image/svg+xml"});
}

function doFilter(img, filter) {
   var w = img.width;
   var h = img.height;
   var imgUrl = img.src;
   var fId = filter.name;
   var data = (
     "<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"" +
     " width=\"" + w + "\" height=\"" + h + "\" >" +
     "<image filter=\"url(data:image/svg+xml," +
     escape(
        "<svg xmlns=\"http://www.w3.org/2000/svg\"><filter id=\"" + fId + "\"><" +
        filter.value +
        "/></filter></svg>"
     ) +
     "#" + fId + ")\"" +
     " preserveAspectRatio=\"xMinYMin meet\"" +
     " width=\"" + w + "\" height=\"" + h + "\" xlink:href=\"" +
     imgUrl +
     "\"></image></svg>"
   );
   return new Blob([data], {type:"image/svg+xml"});
}

window.onload = function() {
   var inputElt = document.getElementById('upldFile');
   inputElt.onchange = function() {
      if (this.files && this.files[0]) {
         for (var i=0; i < this.files.length; ++i) {
            pendingPhotos.push(this.files[i]);
         }
//       var canvas = document.createElement("CANVAS");
//       var ctx = canvas.getContext('2d');
         var oImgData = pendingPhotos[0];
         var oImg = document.getElementById("originalImage");
         oImg.onload = function() {
//          fImg.onload = function() {
//             ctx.drawImage(fImg, 0, 0);
               // URL.revokeObjectURL(this.src);
//             canvas.toBlob(
//                function(blob) {
//                }
//             );
//          };
            var f0Img = document.getElementById("filter0Image");
            f0Img.src = URL.createObjectURL(doFilter(oImg, filters[0]));
            var f1Img = document.getElementById("filter1Image");
            f1Img.src = URL.createObjectURL(doFilter(oImg, filters[1]));
            var f2Img = document.getElementById("filter2Image");
            f2Img.src = URL.createObjectURL(doFilter(oImg, filters[2]));
            var f3Img = document.getElementById("filter3Image");
            f3Img.src = URL.createObjectURL(doFilter2(oImg));
         }
         oImg.src = URL.createObjectURL(oImgData);

      }else {
         alert("NO IMAGE");
      }
   }
   inputElt.click();
}
</SCRIPT>
</HEAD>
<BODY bgcolor="gray">
<DIV>
   <IMG width="200px" id="originalImage"/>
   <IMG id="filter0Image"/>
   <IMG id="filter1Image"/>
   <IMG id="filter2Image"/>
</DIV>
<DIV>
   <HR/>
   <IMG width=200px id="filter3Image"/>
   <HR/>
</DIV>
<INPUT type='file' id='upldFile' multiple accept="image/"/>
</BODY>
</HTML>
